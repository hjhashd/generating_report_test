# Git 管理与部署测试计划

为了验证项目的 Git 管理、部署及回滚流程是否可靠，建议按照以下步骤进行实践测试。

## 🧪 测试目标
1. 验证 `deploy.sh` 能否正确提交代码、打标签、推送并部署。
2. 验证 `rollback.sh` 能否正确回滚到指定版本。
3. 验证 Docker Profiles (dev/prod) 的隔离性。

---

## 📅 测试步骤

### ⚠️ 前置要求
- **用户身份**：请确保使用 `cqj` 用户执行脚本。使用 `root` 用户可能会导致 SSH 推送权限错误。

### 第一阶段：开发与本地验证
1. **修改代码**：
   - 修改 `new_report.py` 中的一个微小文案或逻辑（例如修改一个 API 的返回提示）。
2. **启动开发环境**：
   ```bash
   ./start-dev.sh
   ```
3. **验证修改**：
   - 访问 `http://localhost:34521` 确认修改已生效（热重载）。

### 第二阶段：生产部署测试
1. **执行部署脚本**：
   ```bash
   ./deploy.sh
   ```
   - 提示输入 Commit Message 时，输入 `test: deployment verification`。
2. **检查 Git 状态**：
   - 执行 `git log --oneline --graph` 查看是否生成了新的 `backup-YYYYMMDD-HHMMSS` 标签。
   - 执行 `git remote -v` 确认推送到的是 `backup` 远程仓库。
3. **验证生产环境**：
   - 访问生产环境地址（脚本输出的 URL，通常端口是 `12543`）。
   - 确认修改已在生产环境中生效。

### 第三阶段：回滚测试
1. **再次修改代码**（引入一个明显的“错误”或不同的文案）：
   - 修改代码并再次执行 `./deploy.sh`。
2. **执行回滚**：
   ```bash
   ./rollback.sh
   ```
   - 从列表中选择刚才第一阶段生成的备份标签。
3. **验证回滚结果**：
   - 再次访问生产环境地址。
   - 确认代码已恢复到第一阶段部署后的状态。
4. **恢复开发状态**：
   ```bash
   git checkout main
   ```

---

## 📊 实用性评估总结

### 优点
- **低成本**：无需复杂的 CI/CD 平台（如 Jenkins/GitHub Actions）。
- **高可靠性**：基于 Git Tag 的回滚是秒级的，且 Docker 保证了环境一致性。
- **流程规范**：强制要求提交信息和自动备份，适合敏捷开发。

### 改进建议
- **监控集成**：可以考虑在 `deploy.sh` 中加入简单的 `curl` 检查，确保容器启动后服务可用。

---
*测试计划制定日期：2026-02-01*
