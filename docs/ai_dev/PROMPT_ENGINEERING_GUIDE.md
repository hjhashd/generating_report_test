# AI 提示词工程指南 (Prompt Engineering Guide)

本文档总结了项目中与大语言模型 (LLM) 交互时的提示词设计原则与最佳实践，特别是针对政务写作与代码生成的混合场景。

## 1. 核心原则

### 1.1 风格与格式的平衡
在政务写作场景中，我们通常要求“语言正式”、“严谨”。然而，过于强调这些词汇可能导致模型（尤其是参数量较小的模型或 Coding 类模型）误以为只能生成纯文本段落，从而拒绝生成表格、列表或代码块。

**反面教材 (Bad Case)**：
> "你是一个政务助手。请生成一份报告。要求语言正式、结构清晰、直接输出正文。"

*后果*：当用户要求生成表格时，模型可能会回答“无法生成表格，以下是表格内容的文字描述...”，或者强行用文字罗列数据。

**最佳实践 (Best Practice)**：
> "你是一个政务助手。要求语言正式。**如果用户要求生成表格、列表等特定格式，请务必满足。输出内容支持 Markdown 渲染。**"

*效果*：明确授权模型使用富文本格式，解除其“自我审查”。

### 1.2 明确输出格式
始终显式指定输出格式，不要让模型猜测。

*   **JSON 输出**：明确字段名和类型。
*   **Markdown 输出**：明确是否需要标题、是否需要代码块。
*   **流式输出**：注意流式输出中不要包含 JSON 结构，除非是纯数据接口。

## 2. 常见场景 Prompt 模板

### 2.1 政务材料生成 (支持富文本)

```python
system_content = f"""
今天日期：{current_date}
你是一个政务材料撰写辅助AI。

【参考材料】
{full_materials_text}

【任务指令】
请基于上述材料，完成以下任务：
1. 严格基于材料内容，不编造。
2. 语言正式、严谨。
3. 如果用户要求生成表格、列表等特定格式，请务必满足。
4. 输出内容使用 Markdown 格式渲染（支持表格、粗体等）。
5. 直接输出正文内容，不需要JSON格式。
"""
```

### 2.2 纯数据提取 (JSON)

```python
system_content = """
你是一个数据提取助手。请从以下文本中提取关键信息。
输出必须是合法的 JSON 格式，不要包含 ```json 包裹。
格式示例：
{"name": "...", "date": "..."}
"""
```

## 3. 模型特定优化 (Model-Specific Tuning)

### 3.1 Qwen3-Coder
*   **特点**：逻辑性强，代码能力强，但对指令遵循较死板。
*   **优化**：需要明确告知“支持 Markdown 表格”，否则它倾向于写代码或纯文本。

### 3.2 DeepSeek-R1 / Llama3
*   **特点**：通用能力强，幻觉控制需注意。
*   **优化**：需强调“严格基于材料”，防止发散。

## 4. 调试技巧

1.  **System Prompt 优先级**：System Prompt 奠定基调，User Prompt 提供具体指令。如果 User 指令无效，检查 System Prompt 是否有冲突的限制（如“只能输出文字”）。
2.  **流式输出排查**：如果前端显示乱码或错误信息，检查后端是否将 Exception 混入了流数据中（如 `yield f"data: {error}"`）。

